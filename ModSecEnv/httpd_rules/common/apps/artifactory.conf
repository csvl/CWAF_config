<Macro Artifactory_Proxy_ $(ssl) @frontServer $frontPath @protocol $backServer $backPort @backPath>
 Use Proxy$(ssl)Ext @frontServer "$frontPath" @protocol "$backServer" $backPort @backPath
 Use SecWebAppId Artifactory

 Use ParseArgInURL "^($frontPath/artifactory/api/nuget/)(.*)$"
 Use ParseArgInURL "^($frontPath/artifactory/ui/builds/[^/]+/)([^/]+)"
 Use ParseArgInURL "^($frontPath/artifactory/webapp/builds/)([^/]+)"

 Use Atlassian "$frontPath"
  
 <Location $frontPath/>
  Use PackageSoftware
  Use SetSession "SESSION"

  Use CSPAllowInternalStyle
  Use CSPAllowInternalScript
  Use CSPAllowEvalInScript
  Use CSPAddDirective font-src "data:"

  Use SecAllowQueryInPost
  Use SecArgNameAllowCharacter "$()"

  Use AllowJson
  
  # Allow all file upload/download
  Use SecAllowAllExt
  Use SecAllowDotInUrl
  Use SecAllowAllDownFileExt
  Use SecAllowAllUpFilenames
  Use SecAllowAllContentType
  Use SecAllowMissingCT
  
  # Allow {} in cookies
  Use SecRuleRemoveById 2000367,2000403

  # allow 2 quotes ''
  Use SecRuleRemoveById 2003131
  Use SecAllowNamespaces
  Use SecAllowAllContentType
  Use AllowAutomatedTools
 </Location>

 <Location $frontPath/artifactory>
  Use SecAllowUpDownFileExt "pom,jar,nupkg"
  #Use SecAllowExt "pom|jar"
  # Allow : in basename: /artifactory/.../:SmartTOC:unspecified?...
  Use SecAllowCharsInBasename ":"
  # Allow /org.apache. in URL filename (.pom files)
  Use SecRuleRemoveById 4003227
  Use SecAllowTechnicalInURL
 </Location>

 <Location $frontPath/artifactory/api>
  Use SecAllowPipeInArgs
 # Allow "/system" in URL, allow "xpath" in arg, allow // in arg as in build_builuri=vstfs:///build/...
  Use SecRuleRemoveById 2001209,2000354,2000442
  Use SecAllowWindowsPath
  Use SecAllowCharsInUpDownDocs "()=',"
 </Location>

 <Location $frontPath/artifactory/ui>
  Use SecRuleRemoveById "2001203,2002101,4003724"
  Use SecAllowURLArg "typeSpecific.url"
  Use SecAllowTechnicalArgs
  Use SecArgNameAllowEmpty
  Use SecUrlAllowChars " "
  Use SecUrlAllowPlus
 </Location>

 <Location $frontPath/artifactory/api/nuget>
  # Allow ()
  Use SecRuleRemoveById 2000363
  Use AllowEmptyUA
 </Location>

 <Location $frontPath/artifactory/Atlas-NuGet-Repository>
  Use SecUrlAllowChars "!"
 </Location>

 <Location $frontPath/artifactory/webapp/images/wizard-icons/icon_4_build_gif@2.935.gif>
  Use SecAllowCharsInUpDownDocs "@"
 </Location>

 <LocationMatch ^$frontPath/artifactory/ui/artifact/(deploy/multi|upload)$>
  Use SecUploadFileSizeMax 50000000
  Use SecUploadTotalFileSizeMax 50000000
 </LocationMatch>

 <LocationMatch ^$frontPath/artifactory/ui/builds/modulesArtifact>
  Use SecAllowCharsInUpDownDocs ":"
 </LocationMatch>

 <LocationMatch ^$frontPath/artifactory/ui/builds/overrideLicenses>
  Use SecArgsJsonNbMax 10000
 </LocationMatch>

 <LocationMatch ^$frontPath/v2/.+/(md5|(sha(1|256))):>
  Use SecAllowCharsInUpDownDocs ":"
 </LocationMatch>
</Macro>

<Macro Artifactory_Proxy @frontServer @frontPath @protocol @backServer @backPort @backPath>
 Use Artifactory_Proxy_ "" @frontServer @frontPath @protocol @backServer @backPort @backPath
</Macro>
<Macro Artifactory_ProxySSL @frontServer @frontPath @protocol @backServer @backPort @backPath>
 Use Artifactory_Proxy_ SSL @frontServer @frontPath @protocol @backServer @backPort @backPath
</Macro>
