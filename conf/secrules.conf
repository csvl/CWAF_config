# Order of processing:
#  * phase: 1, 2, 3, 4, 5
#     - phase 1 not executed in Location & in If
#  * if: none, 1, 2, 3, ...
#  * global: server, vhost
#  * location (server , vhost)
#  * inside same scope from top

Define Server2   anything_even_0_or_nothing
Define NoServer4

Use BeginVhost _default_
 Use  OrderAddEnvLoc 5001 vhost1
 Use  OrderAddEnvLoc 5002 vhost2
Use EndVhost
Use   OrderAddEnvLoc 5003 server1
<IfDefine Server2>
 # Active
 Use  OrderAddEnvLoc 5004 server2
</IfDefine>
<IfDefine Server3>
 # Not active
 Use  OrderAddEnvLoc 5005 server3
</IfDefine>
<IfDefine !NoServer4>
 # Not active
 Use  OrderAddEnvLoc 5006 server4
</IfDefine>

# Expected order (all cases):
#  server1-if0-ph1/server2-if0-ph1/vhost1-if0-ph1/vhost2-if0-ph1
# /server1-if0-ph2/server2-if0-ph2/vhost1-if0-ph2/vhost2-if0-ph2/server1-loc-if0-ph2/server2-loc-if0-ph2/vhost1-loc-if0-ph2/vhost2-loc-if0-ph2/server1-if1-ph2/server2-if1-ph2/vhost1-if1-ph2/vhost2-if1-ph2/server1-loc-if1-ph2/server2-loc-if1-ph2/vhost1-loc-if1-ph2/vhost2-loc-if1-ph2/server1-if2-ph2/server2-if2-ph2/vhost1-if2-ph2/vhost2-if2-ph2/server1-loc-if2-ph2/server2-loc-if2-ph2/vhost1-loc-if2-ph2/vhost2-loc-if2-ph2
# /server1-if0-ph3/server2-if0-ph3/vhost1-if0-ph3/vhost2-if0-ph3/server1-loc-if0-ph3/server2-loc-if0-ph3/vhost1-loc-if0-ph3/vhost2-loc-if0-ph3/server1-if1-ph3/server2-if1-ph3/vhost1-if1-ph3/vhost2-if1-ph3/server1-loc-if1-ph3/server2-loc-if1-ph3/vhost1-loc-if1-ph3/vhost2-loc-if1-ph3/server1-if2-ph3/server2-if2-ph3/vhost1-if2-ph3/vhost2-if2-ph3/server1-loc-if2-ph3/server2-loc-if2-ph3/vhost1-loc-if2-ph3/vhost2-loc-if2-ph3
# /server1-if0-ph4/server2-if0-ph4/vhost1-if0-ph4/vhost2-if0-ph4/server1-loc-if0-ph4/server2-loc-if0-ph4/vhost1-loc-if0-ph4/vhost2-loc-if0-ph4/server1-if1-ph4/server2-if1-ph4/vhost1-if1-ph4/vhost2-if1-ph4/server1-loc-if1-ph4/server2-loc-if1-ph4/vhost1-loc-if1-ph4/vhost2-loc-if1-ph4/server1-if2-ph4/server2-if2-ph4/vhost1-if2-ph4/vhost2-if2-ph4/server1-loc-if2-ph4/server2-loc-if2-ph4/vhost1-loc-if2-ph4/vhost2-loc-if2-ph4
# /server1-if0-ph5/server2-if0-ph5/vhost1-if0-ph5/vhost2-if0-ph5/server1-loc-if0-ph5/server2-loc-if0-ph5/vhost1-loc-if0-ph5/vhost2-loc-if0-ph5/server1-if1-ph5/server2-if1-ph5/vhost1-if1-ph5/vhost2-if1-ph5/server1-loc-if1-ph5/server2-loc-if1-ph5/vhost1-loc-if1-ph5/vhost2-loc-if1-ph5/server1-if2-ph5/server2-if2-ph5/vhost1-if2-ph5/vhost2-if2-ph5/server1-loc-if2-ph5/server2-loc-if2-ph5/vhost1-loc-if2-ph5/vhost2-loc-if2-ph5

# Specific requests ------------------------------------------------------------
# Add after server1-loc-if0-ph2
<LocationMatch /loc2>
 Use OrderAddEnv 5010 loc2
</LocationMatch>

# Rules removal ------------------------------------------------------------
# Remove all "server2" (by id)
<LocationMatch /SecRuleRemoveById>
 Use SecRuleRemoveById 5004
</LocationMatch>

# Remove "vhost1-if0-ph4" (by tag)
<LocationMatch /SecRuleRemoveByFullTag>
 Use SecRuleRemoveByFullTag "vhost1-if0-ph4"
</LocationMatch>

# Remove all "if1" & "if2" (by tag regex)
<LocationMatch /SecRuleRemoveByTag>
 Use SecRuleRemoveByTag "if[12]-"
</LocationMatch>
