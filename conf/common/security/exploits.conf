# Various exploits
# Range: 2001000-2001099

# Honeypot
Use SecRuleUrl  "^/@secure"   2001010,tag:HONEYPOT  "phase:1,t:none,~{caseSensitive},~{increaseBlockCounterMax},~{status404},msg:'Honeypot'"

# Secure Socket Tunneling Protocol not allowed
#Use SecRule REQUEST_METHOD "SSTP"   "phase:1,t:none,msg:'Invalid method SSTP',id:2001004,tag:EXPLOIT"

# Attack on Content-Type
Use SecRuleHeader Content-Type "(?i)\bname\s*+="             "phase:1,t:none,msg:'Invalid Content-Type',id:2001001,tag:EXPLOIT,tag:Equal"
Use SecRuleHeader Content-Type "(?i);\s*+boundary\s*+=.{513}" "phase:1,t:none,msg:'Invalid Content-Type',id:2001002,tag:EXPLOIT,tag:Equal,tag:SemiColon"

# CVE-2010-4476 (ex. header: Accept-Language: en-us;q=2.2250738585072012e-308)
# http://www.exploringbinary.com/php-hangs-on-numeric-value-2-2250738585072011e-308/
# Also .0...022250738585072012
DefineStr  BigFloatPattern  "2[.]?2[.]?2[.]?5[.]?0[.]?7[.]?3[.]?8[.]?5[.]?8[.]?5[.]?0[.]?7[.]?2[.]?0[.]?1[.]?[12][.0-9]*[eE]-0*[23][0-9]{2}|0{107}2225073858507201"
Use SecRule REQUEST_HEADERS "~{BigFloatPattern}" "phase:1,t:none,~{increaseBlockCounterMax},~{status}:500,msg:'Big float exploit',tag:Parano,tag:EXPLOIT,tag:Dash,tag:noreport2"
Use SecRuleArgs             "~{BigFloatPattern}"  2001000,tag:Parano,tag:EXPLOIT,tag:Dash,tag:noreport2  "~{status}:500,msg:'Big float exploit'"

# Anonymous DDoS
#Use SecRule QUERY_STRING "No A la CENSURA EN INTERNET¡¡¡" "phase:1,~{increaseBlockCounterMax},~{drop},t:none,msg:'Anonymous DDoS',tag:EXPLOIT"

# JS LOIC DDoS
#SecRule QUERY_STRING "IMMA CHARGING MAH LAZER" "phase:1,t:none,~{increaseBlockCounterMax},~{drop},msg:'LOIC DoS tool',tag:EXPLOIT"

# Usual message
Use SecRuleInputHeaders1 "(?i)\bpwn[3e]d\b"  2001001 tag:EXPLOIT,tag:Parano,tag:SHORT,tag:PossibleName  "~{status}:500,msg:'Hacking attempt'"

# Adobe reader XSS (request does not reach server, so check for inclusion only)
# Exploits: http://www.wisec.it/vulns.php?page=9
#Use SecRuleArgsCookies  "(?i)[.]pdf#(?:####|(?:(?:x?fdf|xml)=)|.*javascript)"  2001003,tag:EXPLOIT,tag:Dot,tag:AtSign "t:~{jsDecode},msg:'PDF exploit. Matched signature'"

# Oracle Application Framework 
#Use SecRuleDeny ARGS_NAMES|REQUEST_COOKIES_NAMES "(?i)\boa(?:diagnostic|developermode)"  "phase:2,t:none,~{status}:400,msg:'Oracle Application Framework admin mode',tag:EXPLOIT"

# MHTML Mime-Formatted Request Vulnerability (CVE 2011-0096)
# http://www.codefornuts.com/2011/02/xss-awareness-2-internet-explorer-mhtml_11.html
# Already blocked by another rule
#Use SecRuleArgsCookies  "content-type: [^\r\f\n]+?\bmultipart/related[^\r\f\n]+[\r\f\n]{2}--"   2001006,tag:EXPLOIT,tag:Colon,tag:NewLine,tag:Slash,tag:Dash  "t:none,tag:Slash,~{status}:400,msg:'MHTML XSS exploit'"

# Shellshock -------------------------------------------------------------------
# At beginning of field => generic rule should be safe
Use SecRuleDeny REQUEST_URI_RAW|REQUEST_HEADERS_NAMES|REQUEST_HEADERS|ARGS_NAMES|ARGS|FILES|FILES_NAMES|TX:uploadfname "^[(][)] [{] " "phase:2,t:~{jsDecode},~{status}:400,tag:EXPLOIT,tag:Parenthesis,tag:CurlyBrace,msg:'bash shellshock exploit (CVE-2014-6271,...)'"
# ------------------------------------------------------------------------------

#Use SecRule REQUEST_HEADERS:Referer "//code.google.com/p/slowhttptest/" "phase:1,t:none,~{increaseBlockCounterMax},~{drop},msg:'DoS tool',tag:EXPLOIT"

#Use SecRuleInputHeaders "(?>https?://[^/ '\x22>]*)google[^ '\x22>]*\busg="  2001009 2001005 tag:colon,tag:Slash,tag:EXPLOIT "msg:'Google redirect abuse'"

# Man-in-the-Middle capturing credentials (user under attack)
Use InvalidRequestHeader_ X-Evilginx "phase:1,~{increaseBlockCounterMax},msg:'evilginx2 man-in-the-middle attack framework (user is victim)',tag:EXPLOIT"

# Worms/exploits
<Macro Worm_ @target $pattern $action>
 SecRule @target "(?i)$pattern"  "phase:2,t:none,~{increaseBlockCounterMax},~{drop},severity:ALERT,tag:EXPLOIT,tag:noreport1,msg:'Worm',$action"
</Macro>
#Use Worm_ TX:url      "Hacked\s*+by\s*+member\s*+of"      ""
#Use Worm_ TX:url      "Ringing[.]at[.]your[.]dorbell"  ""
#Use Worm_ TX:url      "[.]asp[?](?:.*theAct=inject&thePath=|pageName=AppFileExplorer|.*showUpload&thePath=)"   "msg:'Rootkit'"
#Use Worm_ REQUEST_HEADERS_NAMES "x_(?:key|file)\b"          "msg:'Rootkit'"
#Use Worm_ REQUEST_HEADERS  "XXXXXX[+]:|[+]{13}"   ""
#Use Worm_ REQUEST_HEADERS|!REQUEST_HEADERS:Cookie  "\bx-aaaaaa"   "tag:Dash,msg:'Spam worm'"
#Use Worm_ ~{args} "\becho _GHC/RST_"               "tag:ARGS,tag:Underscore,msg:'worm'"
#Use Worm_ ~{args} "\b(?:netenberg|psybnc)\b"       "tag:ARGS,tag:PossibleName,msg:'Frantastico worm'"
#Use Worm_ ~{args} "\bfantastico_de_luxe\b"         "tag:ARGS,tag:Dot,msg:'Frantastico worm'"
#Use Worm_ ~{args} "_@@RNDSTR@@"                    "tag:ARGS,tag:Underscore,tag:AtSign,msg:'worm'"
#Use Worm_ REQUEST_HEADERS:USER-AGENT  "gawa.sa.pilipinas"   ""
#Use Worm_ REQUEST_HEADERS:USER-AGENT  "bwh3_user_agent|jaascois|kmccrew|planetwork"   ""
Use Worm_ REQUEST_HEADERS:USER-AGENT  "<script|javascript:|&[{][(]|<a href"             ""
